From 420713dbbff69586b7ad51025ae752eaf5440c8d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Graber?= <stgraber@ubuntu.com>
Date: Wed, 9 Dec 2015 15:12:09 -0500
Subject: Use the mountpoint command when available
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Our Go implementation doesn't appear to catch every possible corner
cases, in my case, a bind-mount from the same underlying tmpfs as the
parent directory.

Signed-off-by: St√©phane Graber <stgraber@ubuntu.com>
---
 shared/util_linux.go | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/shared/util_linux.go b/shared/util_linux.go
index 7002ec3..d9e7bc1 100644
--- a/shared/util_linux.go
+++ b/shared/util_linux.go
@@ -7,6 +7,7 @@ import (
 	"errors"
 	"fmt"
 	"os"
+	"os/exec"
 	"syscall"
 	"unsafe"
 )
@@ -321,6 +322,16 @@ func GetFileStat(p string) (uid int, gid int, major int, minor int,
 }
 
 func IsMountPoint(name string) bool {
+	_, err := exec.LookPath("mountpoint")
+	if err == nil {
+		err = exec.Command("mountpoint", "-q", name).Run()
+		if err != nil {
+			return false
+		}
+
+		return true
+	}
+
 	stat, err := os.Stat(name)
 	if err != nil {
 		return false
