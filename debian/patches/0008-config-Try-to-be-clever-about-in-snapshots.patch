From f1b23226c63b957196596f84075dfb30d75e5730 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Graber?= <stgraber@ubuntu.com>
Date: Sat, 1 Jul 2017 01:33:31 -0400
Subject: config: Try to be clever about ":" in snapshots
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

If we detect a ":" in the provided string and can't find any remote with
that name and we detect a "/" in the resource name, then assume we're
dealing with a snapshot containing ":" and select the default remote.

Launchpad: https://bugs.launchpad.net/ubuntu/+source/lxd/+bug/1694855
Signed-off-by: St√©phane Graber <stgraber@ubuntu.com>
---
 lxc/config/remote.go | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/lxc/config/remote.go b/lxc/config/remote.go
index 3317ccc4..e5d255e6 100644
--- a/lxc/config/remote.go
+++ b/lxc/config/remote.go
@@ -21,11 +21,16 @@ type Remote struct {
 func (c *Config) ParseRemote(raw string) (string, string, error) {
 	result := strings.SplitN(raw, ":", 2)
 	if len(result) == 1 {
-		return c.DefaultRemote, result[0], nil
+		return c.DefaultRemote, raw, nil
 	}
 
 	_, ok := c.Remotes[result[0]]
 	if !ok {
+		// Attempt to play nice with snapshots containing ":"
+		if shared.IsSnapshot(raw) && strings.Contains(result[0], "/") {
+			return c.DefaultRemote, raw, nil
+		}
+
 		return "", "", fmt.Errorf("The remote \"%s\" doesn't exist", result[0])
 	}
 
