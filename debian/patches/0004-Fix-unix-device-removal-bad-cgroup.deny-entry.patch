From 6c4223d58a6c77af399afd1ed7e13a18e07dc820 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Graber?= <stgraber@ubuntu.com>
Date: Thu, 23 Mar 2017 22:50:03 -0400
Subject: Fix unix device removal (bad cgroup.deny entry)
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This got fixed in the insert function a little while back, but the
matching code in the remove function was missed.

Closes #3107

Signed-off-by: St√©phane Graber <stgraber@ubuntu.com>
---
 lxd/container_lxc.go | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/lxd/container_lxc.go b/lxd/container_lxc.go
index 5267c1a4..565c0feb 100644
--- a/lxd/container_lxc.go
+++ b/lxd/container_lxc.go
@@ -5464,8 +5464,10 @@ func (c *containerLXC) removeUnixDevice(m types.Device) error {
 	}
 
 	dType := ""
-	if m["type"] != "" {
-		dType = m["type"]
+	if m["type"] == "unix-char" {
+		dType = "c"
+	} else if m["type"] == "unix-block" {
+		dType = "b"
 	}
 
 	if dType == "" || dMajor < 0 || dMinor < 0 {
