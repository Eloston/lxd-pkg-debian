From 2e73211a560eac132ef201ef6c74a9741663445c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Graber?= <stgraber@ubuntu.com>
Date: Thu, 29 Sep 2016 00:37:14 -0400
Subject: test: Fix apparmor version check
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: St√©phane Graber <stgraber@ubuntu.com>
---
 test/suites/basic.sh | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/test/suites/basic.sh b/test/suites/basic.sh
index 5bcfdc9..2cbf0ee 100644
--- a/test/suites/basic.sh
+++ b/test/suites/basic.sh
@@ -313,7 +313,15 @@ test_basic_usage() {
   # check that an apparmor profile is created for this container, that it is
   # unloaded on stop, and that it is deleted when the container is deleted
   lxc launch testimage lxd-apparmor-test
+
+  MAJOR=0
+  MINOR=0
   if [ -f /sys/kernel/security/apparmor/features/domain/version ]; then
+    MAJOR=$(awk -F. '{print $1}' < /sys/kernel/security/apparmor/features/domain/version)
+    MINOR=$(awk -F. '{print $2}' < /sys/kernel/security/apparmor/features/domain/version)
+  fi
+
+  if [ "${MAJOR}" -gt "1" ] || ([ "${MAJOR}" = "1" ] && [ "${MINOR}" -ge "2" ]); then
     aa_namespace="lxd-lxd-apparmor-test_<$(echo "${LXD_DIR}" | sed -e 's/\//-/g' -e 's/^.//')>"
     aa-status | grep ":${aa_namespace}://unconfined"
     lxc stop lxd-apparmor-test --force
