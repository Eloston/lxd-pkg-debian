From bc239f0c4f3c8e38e7636b8403199548fb48bed7 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Graber?= <stgraber@ubuntu.com>
Date: Wed, 30 Sep 2015 18:35:46 -0400
Subject: tests: Don't fail on kernel race conditions
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

On some systems it seems to be possible to run into a case where the MAC
address of a device isn't actually set for a while.

This is likely a kernel issue as a veth pair device should always have a
MAC, but it's shown up a few times, especially in the Ubuntu CI lab and
is annoying, so let's ignore that case since it's clearly not a LXD bug.

Signed-off-by: St√©phane Graber <stgraber@ubuntu.com>
---
 test/suites/basic.sh | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/test/suites/basic.sh b/test/suites/basic.sh
index 134cd09..50cb53c 100644
--- a/test/suites/basic.sh
+++ b/test/suites/basic.sh
@@ -140,7 +140,7 @@ test_basic_usage() {
   lxc start foo
   mac2=$(lxc exec foo cat /sys/class/net/eth0/address)
 
-  if [ "${mac1}" != "${mac2}" ]; then
+  if [ -n "${mac1}" ] && [ -n "${mac2}" ] && [ "${mac1}" != "${mac2}" ]; then
     echo "==> MAC addresses didn't match across restarts (${mac1} vs ${mac2})"
     false
   fi
