From 54d233f08e65af852dbd3985eaf67b48a226cab5 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Graber?= <stgraber@ubuntu.com>
Date: Fri, 31 Mar 2017 20:24:02 -0400
Subject: profiles: Fix ETag handling
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: St√©phane Graber <stgraber@ubuntu.com>
---
 lxd/profiles.go | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/lxd/profiles.go b/lxd/profiles.go
index ca2c660e..4d723223 100644
--- a/lxd/profiles.go
+++ b/lxd/profiles.go
@@ -129,7 +129,8 @@ func profileGet(d *Daemon, r *http.Request) Response {
 		return SmartError(err)
 	}
 
-	return SyncResponseETag(true, resp, resp)
+	etag := []interface{}{resp.Config, resp.Description, resp.Devices}
+	return SyncResponseETag(true, resp, etag)
 }
 
 func getContainersWithProfile(d *Daemon, profile string) []container {
@@ -161,7 +162,8 @@ func profilePut(d *Daemon, r *http.Request) Response {
 	}
 
 	// Validate the ETag
-	err = etagCheck(r, profile)
+	etag := []interface{}{profile.Config, profile.Description, profile.Devices}
+	err = etagCheck(r, etag)
 	if err != nil {
 		return PreconditionFailed(err)
 	}
@@ -183,7 +185,8 @@ func profilePatch(d *Daemon, r *http.Request) Response {
 	}
 
 	// Validate the ETag
-	err = etagCheck(r, profile)
+	etag := []interface{}{profile.Config, profile.Description, profile.Devices}
+	err = etagCheck(r, etag)
 	if err != nil {
 		return PreconditionFailed(err)
 	}
