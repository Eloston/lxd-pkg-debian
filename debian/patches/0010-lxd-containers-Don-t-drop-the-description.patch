From d3ecf1c3b72bbdbc168ae8106e29fd952a7aeb4b Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Graber?= <stgraber@ubuntu.com>
Date: Mon, 8 Jan 2018 01:33:32 -0500
Subject: lxd/containers: Don't drop the description
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Closes #4143

Signed-off-by: St√©phane Graber <stgraber@ubuntu.com>
---
 lxd/container_lxc.go  | 2 ++
 lxd/patches.go        | 1 +
 lxd/profiles_utils.go | 4 +++-
 3 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/lxd/container_lxc.go b/lxd/container_lxc.go
index ef06a75e..236123b5 100644
--- a/lxd/container_lxc.go
+++ b/lxd/container_lxc.go
@@ -2967,6 +2967,7 @@ func (c *containerLXC) Restore(sourceContainer container, stateful bool) error {
 		Devices:      sourceContainer.LocalDevices(),
 		Ephemeral:    sourceContainer.IsEphemeral(),
 		Profiles:     sourceContainer.Profiles(),
+		Description:  sourceContainer.Description(),
 	}
 
 	err = c.Update(args, false)
@@ -3312,6 +3313,7 @@ func (c *containerLXC) ConfigKeySet(key string, value string) error {
 		Devices:      c.localDevices,
 		Ephemeral:    c.ephemeral,
 		Profiles:     c.profiles,
+		Description:  c.description,
 	}
 
 	return c.Update(args, false)
diff --git a/lxd/patches.go b/lxd/patches.go
index 187b9c03..79367d5a 100644
--- a/lxd/patches.go
+++ b/lxd/patches.go
@@ -1777,6 +1777,7 @@ func updatePoolPropertyForAllObjects(d *Daemon, poolName string, allcontainers [
 			LastUsedDate: c.LastUsedDate(),
 			Name:         c.Name(),
 			Profiles:     c.Profiles(),
+			Description:  c.Description(),
 		}
 
 		if c.IsSnapshot() {
diff --git a/lxd/profiles_utils.go b/lxd/profiles_utils.go
index 2a36f24d..9d0c3e0d 100644
--- a/lxd/profiles_utils.go
+++ b/lxd/profiles_utils.go
@@ -114,7 +114,9 @@ func doProfileUpdate(d *Daemon, name string, id int64, profile *api.Profile, req
 			Ephemeral:    c.IsEphemeral(),
 			Config:       c.LocalConfig(),
 			Devices:      c.LocalDevices(),
-			Profiles:     c.Profiles()}, true)
+			Profiles:     c.Profiles(),
+			Description:  c.Description(),
+		}, true)
 
 		if err != nil {
 			failures[c.Name()] = err
