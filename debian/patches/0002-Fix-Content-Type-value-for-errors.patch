From 4ceae3c622863d15e2f08e7b4ccc7b94958cc848 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?St=C3=A9phane=20Graber?= <stgraber@ubuntu.com>
Date: Fri, 19 Feb 2016 11:01:49 -0500
Subject: Fix Content-Type value for errors
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Closes #1622

Signed-off-by: St√©phane Graber <stgraber@ubuntu.com>
---
 lxd/devlxd.go   | 1 -
 lxd/response.go | 7 ++++++-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/lxd/devlxd.go b/lxd/devlxd.go
index 0b941ab..380da30 100644
--- a/lxd/devlxd.go
+++ b/lxd/devlxd.go
@@ -99,7 +99,6 @@ func hoistReq(f func(container, *http.Request) *devLxdResponse, d *Daemon) func(
 
 		resp := f(c, r)
 		if resp.code != http.StatusOK {
-			w.Header().Set("Content-Type", "application/octet-stream")
 			http.Error(w, fmt.Sprintf("%s", resp.content), resp.code)
 		} else if resp.ctype == "json" {
 			w.Header().Set("Content-Type", "application/json")
diff --git a/lxd/response.go b/lxd/response.go
index f916a20..f4f3f48 100644
--- a/lxd/response.go
+++ b/lxd/response.go
@@ -204,7 +204,12 @@ func (r *errorResponse) Render(w http.ResponseWriter) error {
 	if debug {
 		shared.DebugJson(captured)
 	}
-	http.Error(w, buf.String(), r.code)
+
+	w.Header().Set("Content-Type", "application/json")
+	w.Header().Set("X-Content-Type-Options", "nosniff")
+	w.WriteHeader(r.code)
+	fmt.Fprintln(w, buf.String())
+
 	return nil
 }
 
