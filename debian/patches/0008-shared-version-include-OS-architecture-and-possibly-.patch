From b3e064f9a716f511614011fe004c2f378e04a893 Mon Sep 17 00:00:00 2001
From: Alberto Donato <alberto.donato@canonical.com>
Date: Thu, 21 Sep 2017 09:56:12 +0200
Subject: shared/version: include OS, architecture and possibly kernel and
 distro info in User-Agent

Signed-off-by: Alberto Donato <alberto.donato@canonical.com>
---
 shared/version/flex.go | 25 ++++++++++++++++++++++++-
 1 file changed, 24 insertions(+), 1 deletion(-)

diff --git a/shared/version/flex.go b/shared/version/flex.go
index 5feeedbb..48a3537a 100644
--- a/shared/version/flex.go
+++ b/shared/version/flex.go
@@ -1,10 +1,33 @@
 package version
 
+import (
+	"fmt"
+	"runtime"
+	"strings"
+
+	"github.com/lxc/lxd/shared/osarch"
+)
+
 // Version contains the LXD version number
 var Version = "2.18"
 
 // UserAgent contains a string suitable as a user-agent
-var UserAgent = "LXD " + Version
+var UserAgent = getUserAgent()
 
 // APIVersion contains the API base version. Only bumped for backward incompatible changes.
 var APIVersion = "1.0"
+
+func getUserAgent() string {
+	archID, err := osarch.ArchitectureId(runtime.GOARCH)
+	if err != nil {
+		panic(err)
+	}
+	arch, err := osarch.ArchitectureName(archID)
+	if err != nil {
+		panic(err)
+	}
+
+	tokens := []string{strings.Title(runtime.GOOS), arch}
+	tokens = append(tokens, getPlatformVersionStrings()...)
+	return fmt.Sprintf("LXD %s (%s)", Version, strings.Join(tokens, "; "))
+}
